<!DOCTYPE html>
<html>
<head>
  <title>ajlane.id.au</title>
  <link rel="openid2.provider" href="https://www.google.com/accounts/o8/ud?source=profiles" />
  <link rel="openid2.local_id" href="https://plus.google.com/113427245716758655175"/>
  <style>
    body {
      background-color: white;
      background-repeat: no-repeat;
      background-position: bottom center;
      background-size: cover;
      background-attachment: fixed;
    }
    h1 {
      font-family:sans-serif;
      color:white;
      text-align: right;
      position: fixed;
      bottom: 5%;
      right: 10%;
    }
    #canvas {
      position:fixed;
      top:0;
      left:0;
      right:0;
      bottom:0;
      z-index:-1;
    }
  </style>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.8/d3.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-25124081-2', 'auto');
    ga('send', 'pageview');
  </script>
</head>
<body>
  <h1><img src="logo.png" alt="ajlane.id.au"/></h1>
  <script>
    var background = function(num, hue){
      var points = d3.range(num)
        .map(function(d,i) {
          return [Math.random(), Math.random()];
        });
      var voronoi = d3.geom.voronoi()
        .clipExtent([[0,0],[1,1]])
        (points);
      var colour = function(p, i){
        if(!p) p = [0, 0];
        if(!i) i = 0;
        var h = hue + 120 * (p[0] + p[1]) / 2;
        if(h>360)h-=360;
        var c = 80;
        var l = 80 - 60 * (p[0] + p[1]) / 2 + 20 * (i/num);
        return d3.hcl(h,c,l);
      };
      var delay = function(){
        var scale = d3.scale.linear()
        .domain([0, 1])
        .range([0, 1000])
        return function(p,i){ return p ? scale(0.8 - 0.6 * (p[0] + p[1]) / 2 - 0.2 * (i/num)) : 0; }
      }();
      
      var svgSupported = document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure", "1.1");
      if(svgSupported)
      {
        var canvas = d3.select('body')
          .append('svg')
          .attr('id', 'canvas')
          .attr('viewBox', '0 0 1 1')
          .attr('preserveAspectRatio', 'xMidYMid slice');
        var cells = canvas
          .selectAll('path')
          .data(points);
        cells.enter()
          .append('path')
          .attr('d', function(d, i){
            return "M" + voronoi[i].join("L") + "Z";
          })
          .attr('stroke-width', '0.001')
          .attr('fill', 'white')
          .attr('stroke', 'white');      
        cells
          .transition()
          .delay(delay)
          .attr('fill', colour)
          .attr('stroke', colour);        
        d3.select('h1')
          .style('opacity', '0')
          .transition()
          .duration(1500)
          .style('opacity', '1');
      } else {
        // Fallback to canvas
        var width = Math.max(screen.width, window.outerWidth);
        var height = Math.max(screen.height, window.outerHeight);
        var canvas = d3.select('body')
          .append('canvas')
          .attr('id', 'canvas')
          .attr('width', width)
          .attr('height', height);
        var x = function(r){ return r * width; };
        var y = function(r){ return r * height; };
        var context = canvas.node().getContext('2d');
        context.clearRect(0,0,width,height);
        points.forEach(function(p, i){
          var vertices = voronoi[i];
          context.beginPath();
          context.fillStyle = colour(p,i).toString();
          context.strokeStyle = colour(p,i).toString();
          context.lineWidth = 2;
          context.moveTo(x(vertices[0][0]), y(vertices[0][1]));
          for(var i = 1; i < vertices.length; i++){
            context.lineTo(x(vertices[i][0]), y(vertices[i][1]));
          }
          context.closePath();
          context.fill();
          context.stroke();
        });
      }
    };
    background(500, Math.random() * 360)
  </script>
</body>
</html>
